var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};
$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};
$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var l=e[f];if(!(l in d))return;d=d[l]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&($jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+e,e=
$jscomp.propertyToPolyfillSymbol[e],$jscomp.defineProperty(d,e,{configurable:!0,writable:!0,value:b})))};$jscomp.polyfill("Object.is",function(a){return a?a:function(b,c){return b===c?0!==b||1/b===1/c:b!==b&&c!==c}},"es6","es3");$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(b,c){var d=this;d instanceof String&&(d=String(d));var e=d.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var f=d[c];if(f===b||Object.is(f,b))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(b,c){return-1!==$jscomp.checkStringArgs(this,b,"includes").indexOf(b,c||0)}},"es6","es3");
$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(a){if(a)return a;var b=function(e,f){this.$jscomp$symbol$id_=e;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:f})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var c=0,d=function(e){if(this instanceof d)throw new TypeError("Symbol is not a constructor");return new b("jscomp_symbol_"+(e||"")+"_"+c++,e)};return d},"es6","es3");$jscomp.initSymbolIterator=function(){};
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=$jscomp.global[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&$jscomp.defineProperty(d.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.initSymbolAsyncIterator=function(){};$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,b){a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
$jscomp.polyfill("Array.from",function(a){return a?a:function(b,c,d){c=null!=c?c:function(m){return m};var e=[],f="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];if("function"==typeof f){b=f.call(b);for(var l=0;!(f=b.next()).done;)e.push(c.call(d,f.value,l++))}else for(f=b.length,l=0;l<f;l++)e.push(c.call(d,b[l],l));return e}},"es6","es3");
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var e=d.length,f=b.length;c=Math.max(0,Math.min(c|0,d.length));for(var l=0;l<f&&c<e;)if(d[c++]!=b[l++])return!1;return l>=f}},"es6","es3");
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,b,"endsWith");b+="";void 0===c&&(c=d.length);c=Math.max(0,Math.min(c|0,d.length));for(var e=b.length;0<e&&0<c;)if(d[--c]!=b[--e])return!1;return 0>=e}},"es6","es3");$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},b=Object.create(new $jscomp.global.Proxy(a,{get:function(c,d,e){return c==a&&"q"==d&&e==b}}));return!0===b.q}catch(c){return!1}};
$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.polyfill("WeakMap",function(a){function b(){if(!a||!Object.seal)return!1;try{var g=Object.seal({}),k=Object.seal({}),n=new a([[g,2],[k,3]]);if(2!=n.get(g)||3!=n.get(k))return!1;n.delete(g);n.set(k,4);return!n.has(g)&&4==n.get(k)}catch(p){return!1}}function c(){}function d(g){var k=typeof g;return"object"===k&&null!==g||"function"===k}function e(g){if(!$jscomp.owns(g,l)){var k=new c;$jscomp.defineProperty(g,l,{value:k})}}function f(g){if(!$jscomp.ISOLATE_POLYFILLS){var k=Object[g];k&&(Object[g]=
function(n){if(n instanceof c)return n;Object.isExtensible(n)&&e(n);return k(n)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var l="$jscomp_hidden_"+Math.random();f("freeze");f("preventExtensions");f("seal");var m=0,h=function(g){this.id_=(m+=Math.random()+1).toString();if(g){g=$jscomp.makeIterator(g);for(var k;!(k=g.next()).done;)k=k.value,this.set(k[0],k[1])}};h.prototype.set=function(g,k){if(!d(g))throw Error("Invalid WeakMap key");
e(g);if(!$jscomp.owns(g,l))throw Error("WeakMap key fail: "+g);g[l][this.id_]=k;return this};h.prototype.get=function(g){return d(g)&&$jscomp.owns(g,l)?g[l][this.id_]:void 0};h.prototype.has=function(g){return d(g)&&$jscomp.owns(g,l)&&$jscomp.owns(g[l],this.id_)};h.prototype.delete=function(g){return d(g)&&$jscomp.owns(g,l)&&$jscomp.owns(g[l],this.id_)?delete g[l][this.id_]:!1};return h},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_MAP||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var h=Object.seal({x:4}),g=new a($jscomp.makeIterator([[h,"s"]]));if("s"!=g.get(h)||1!=g.size||g.get({x:4})||g.set({x:4},"t")!=g||2!=g.size)return!1;var k=g.entries(),n=k.next();if(n.done||n.value[0]!=h||"s"!=n.value[1])return!1;n=k.next();return n.done||4!=n.value[0].x||"t"!=n.value[1]||!k.next().done?!1:!0}catch(p){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var c=new WeakMap,d=function(h){this.data_={};this.head_=l();this.size=0;if(h){h=$jscomp.makeIterator(h);for(var g;!(g=h.next()).done;)g=g.value,this.set(g[0],g[1])}};d.prototype.set=function(h,g){h=0===h?0:h;var k=e(this,h);k.list||(k.list=this.data_[k.id]=[]);k.entry?k.entry.value=g:(k.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:h,value:g},k.list.push(k.entry),
this.head_.previous.next=k.entry,this.head_.previous=k.entry,this.size++);return this};d.prototype.delete=function(h){h=e(this,h);return h.entry&&h.list?(h.list.splice(h.index,1),h.list.length||delete this.data_[h.id],h.entry.previous.next=h.entry.next,h.entry.next.previous=h.entry.previous,h.entry.head=null,this.size--,!0):!1};d.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=l();this.size=0};d.prototype.has=function(h){return!!e(this,h).entry};d.prototype.get=function(h){return(h=
e(this,h).entry)&&h.value};d.prototype.entries=function(){return f(this,function(h){return[h.key,h.value]})};d.prototype.keys=function(){return f(this,function(h){return h.key})};d.prototype.values=function(){return f(this,function(h){return h.value})};d.prototype.forEach=function(h,g){for(var k=this.entries(),n;!(n=k.next()).done;)n=n.value,h.call(g,n[1],n[0],this)};d.prototype[Symbol.iterator]=d.prototype.entries;var e=function(h,g){var k=g&&typeof g;"object"==k||"function"==k?c.has(g)?k=c.get(g):
(k=""+ ++m,c.set(g,k)):k="p_"+g;var n=h.data_[k];if(n&&$jscomp.owns(h.data_,k))for(h=0;h<n.length;h++){var p=n[h];if(g!==g&&p.key!==p.key||g===p.key)return{id:k,list:n,index:h,entry:p}}return{id:k,list:n,index:-1,entry:void 0}},f=function(h,g){var k=h.head_;return $jscomp.iteratorPrototype(function(){if(k){for(;k.head!=h.head_;)k=k.previous;for(;k.next!=k.head;)return k=k.next,{done:!1,value:g(k)};k=null}return{done:!0,value:void 0}})},l=function(){var h={};return h.previous=h.next=h.head=h},m=0;
return d},"es6","es3");$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(b){var c=$jscomp.checkStringArgs(this,null,"repeat");if(0>b||1342177279<b)throw new RangeError("Invalid count value");b|=0;for(var d="";b;)if(b&1&&(d+=c),b>>>=1)c+=c;return d}},"es6","es3");$jscomp.stringPadding=function(a,b){a=void 0!==a?String(a):" ";return 0<b&&a?a.repeat(Math.ceil(b/a.length)).substring(0,b):""};
$jscomp.polyfill("String.prototype.padStart",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,null,"padStart");return $jscomp.stringPadding(c,b-d.length)+d}},"es8","es3");var mainCamDiv=void 0,vdivs=["v1","v2","v3","v4"],waitingDivs=["videoWaiting","video2Waiting","video3Waiting","video4Waiting"],camsEnabled=0,camClickEnabled=!0,toolbarWidth=140,toolbarHeight=36,toolbarCreated=!1,helpWinTop=88,helpWinWidth=240,helpWinHeight=270;
function closeHelp(){var a=document.getElementById("helpWin");a&&(a.style.display="none")}function showHelp(){var a=document.getElementById("helpWin");a&&(a.style.display="inline")}function positionToolbar(a,b,c){if(a=document.getElementById("camToolbar")){var d=c-toolbarHeight-10;a.style.left=""+(b/2-toolbarWidth/2)+"px";a.style.top=""+d+"px"}if(a=document.getElementById("helpWin"))a.style.top=""+(c/2-helpWinHeight/2+helpWinTop)+"px",a.style.left=b-helpWinWidth-10+"px"}
function getMainDivIndex(){for(var a=0;a<vdivs.length;a++)if(vdivs[a]==mainCamDiv)return a;return-1}
function doResize(){if(appSettings&&0<appSettings.OnvifCams.length){for(var a=0;a<vdivs.length;a++)showHide(vdivs[a],appSettings.OnvifCams[a].Enabled);lsUpdateIndicators()}resizeStorage&&resizeStorage();resizeDeviceInfo&&resizeDeviceInfo();resizeEvents&&resizeEvents();toolbarCreated||(toolbarCreated=!0,CameraToolbar.create("camToolbar",36));showHide("camToolbar",!1);if(a=document.getElementById("aboutDiv"))a.style.height=document.documentElement.clientHeight-80+"px";tabDivs[0]="multicamDiv";var b=
document.documentElement.clientWidth/2,c=.5625*b,d=a=0;document.getElementById("titleBar").style.width=""+document.documentElement.clientWidth+"px";var e=document.getElementById("xmapDiv");e&&(e.style.width=""+document.documentElement.clientWidth+"px",e.style.height=""+(document.documentElement.clientHeight-80)+"px");if(e=document.getElementById("searchWaitingDiv")){var f=document.documentElement.clientWidth,l=document.documentElement.clientHeight;e.style.position="absolute";e.style.top=""+l/2+"px";
e.style.left=""+f/2+"px"}if(appSettings&&0==appSettings.DeviceMode||1==camsEnabled)console.debug("doResize single camera"),b=document.getElementById("v1"),c=document.documentElement.clientWidth,e=.5625*c,b.style.position="relative",b.style.width=""+c+"px",b.style.height=""+e+"px",b.style.top=""+d+"px",b.style.left=""+a+"px",positionToolbar(d,c,e),showHide("camToolbar",null!=mainCamDiv);else if(mainCamDiv){e=waitingDivs[0];b=[];c=[];for(f=0;f<vdivs.length;f++)l=vdivs[f],l!=mainCamDiv?(b.push(l),c.push(waitingDivs[f])):
e=waitingDivs[f];var m=.75*document.documentElement.clientWidth,h=.5625*m;f=.25*document.documentElement.clientWidth;l=.5625*f;var g=document.getElementById(mainCamDiv);g.style.position="absolute";g.style.width=""+m+"px";g.style.height=""+h+"px";g.style.top=""+d+"px";g.style.left=""+a+"px";positionToolbar(d,m,h);if(e=document.getElementById(e))e.style.position="absolute",e.style.top=""+h/2+"px",e.style.left=""+m/2+"px";a=m;for(m=0;m<b.length;m++)g=document.getElementById(b[m]),g.style.position="absolute",
g.style.width=""+f+"px",g.style.height=""+l+"px",g.style.top=""+d+"px",g.style.left=""+a+"px",e=document.getElementById(c[m]),e.style.position="absolute",e.style.top=""+l/2+"px",e.style.left=""+(f/2-32)+"px",d+=l;showHide("gridIcon",!0);showHide("camToolbar",!0)}else for(e=0;e<vdivs.length;e++)a=1==e||3==e?b:0,1<e&&(d=c),f=document.getElementById(vdivs[e]),l=document.getElementById(waitingDivs[e]),0<b&&f&&(f.style.position="absolute",f.style.width=""+b+"px",f.style.height=""+c+"px",f.style.top=""+
d+"px",f.style.left=""+a+"px",l.style.position="absolute",l.style.top=""+c/2+"px",l.style.left=""+(b/2-32)+"px")}function onCameraClick(a){if(camClickEnabled)if(a==mainCamDiv)showCameraToolbar(!0);else{mainCamDiv=a;for(var b=0;b<vdivs.length;b++)if(vdivs[b]==a){lsCameraSelected(b);break}window.setTimeout(doResize,250)}}function gridIconClick(){mainCamDiv=void 0;showHide("gridIcon",!1);window.setTimeout(doResize,250)}var nvrModal,aboutSnippet;
function showNvrModal(a){nvrModal=document.getElementById(a);nvrModal.style.display="block"}function closeLogin(){console.info("closeLogin invoked");nvrModal.style.display="none"}function appShowDisco(){OnvifDiscoUI.showCamerasOrLogin(!0);document.getElementById("cameraList").innerHTML='<p><span class="searching4Cams">Searching for ONVIF cameras</span><br/></p>';showNvrModal("nvrMDiv");OnvifDisco.doDisco(onvifDiscoComplete)}
function onvifDiscoComplete(a){try{OnvifDiscoUI.show(appSettings,a),console.debug("Web:onvifDiscoComplete")}catch(b){console.error(b)}}function onConfigChanged(a){console.debug("App:onConfigChanged");hlsDestroyAll();createHlsPlayers();window.setTimeout(function(){doResize()},1E3)}
function onRemoteConfigChange(a){console.log("$$onRemoteConfigChange is local",OnvifDiscoUI.justSavedFlag,lsJustSavedFlag);OnvifDiscoUI.justSavedFlag||lsJustSavedFlag?lsJustSavedFlag=OnvifDiscoUI.justSavedFlag=!1:(console.log("$$onRemoteConfigChange, is remote refreshing local UI"),appSettings=a,onConfigChanged(a))}
function handleGetConfig(a){appSettings=JSON.parse(a);console.log(appSettings);0==appSettings.GpsEnabled&&(document.getElementById("mapTab").style.display="none");if(0==appSettings.DeviceMode){createPlayer("__IPA__","cam","video",!0);for(a=1;a<vdivs.length;a++)showHide(vdivs[a],!1);camClickEnabled=!1}else createHlsPlayers();doResize();getLatestEvents()}
function createHlsPlayers(){for(var a=camsEnabled=0;a<appSettings.OnvifCams.length;a++){var b="cam",c="video";0<a&&(b+=""+a,c+=""+(a+1));appSettings.OnvifCams[a].Enabled?(camsEnabled++,console.log("handleGetCameras",a,b,c),createPlayer("__IPA__",b,c,!0)):showHide(vdivs[a],!1)}camClickEnabled=0<camsEnabled;0==camsEnabled&&window.setTimeout(appShowDisco,1E3)}function getConfig(){httpGetAsync("/xgconf",handleGetConfig)}
function onHide(){camsEnabled=0;showCameraToolbar(!1);lsHideIndicators();hlsDestroyAll()}function onShow(){window.setTimeout(getConfig,500)}function handleGetAbout(a){var b=document.getElementById("aboutDiv");b&&(b.innerHTML=a);getConfig()}function getAbout(){httpGetAsync("/about",handleGetAbout)}var appmenu,menuItems=["settingsMenuItem","aboutMenuItem","closeMenuItem"],menuIcons=["nxv","info","close"],menuLables=["Configure cameras","About","Close"],SETTINGS=0,ABOUT=1,CLOSE=2,doDiscoCallback;
function createAppMenu(){for(var a="<table>",b=0;b<menuItems.length;b++)a+="<tr>",a+="<td>",a+=createMenuItem(b),a+="</td>",a+="</tr>",a+="<tr>";a+="</table>";appmenu=document.getElementById("appMenu");appMenu.innerHTML=a}
function createMenuItem(a){var b='<div id="'+menuItems[a]+'" class="menuItemOff" onmouseover="hightlighMi('+a+', true);" onmouseout="hightlighMi('+a+', false);" onclick="menuItenClick('+a+');">';b=b+'<table><tr><td  width="28" valign="middle"><img src="web/media/xmenu_'+(menuIcons[a]+'.png" width="24" height="24" />');b=b+"</td><td>"+menuLables[a];return b+"<td></td></tr></table><div>"}var menuVisable=!1;function appMenuClicked(){void 0==appmenu&&createAppMenu();showHideAppMenu()}
function showHideAppMenu(){menuVisable=!menuVisable;var a=document.getElementById("appMenu"),b=document.getElementById("appMenuDiv");a&&b&&(menuVisable?(b.style.display="inline",a.style.display="inline",a.className="slide-in"):(a.className="slide-out",window.setTimeout(function(){a.style.display="none";b.style.display="none"},500)))}
function menuItenClick(a){selectMenuUtem(a);window.setTimeout(function(){hightlighMi(a,!1);showHideAppMenu();showHideAbout(!1);console.info("menuItenClick");switch(a){case SETTINGS:doDiscoCallback();break;case ABOUT:nvrModal&&(nvrModal.style.display="none"),showHideAbout(!0)}},350)}function hightlighMi(a,b){if(a=document.getElementById(menuItems[a]))a.className=b?"menuItemOn":"menuItemOff"}function selectMenuUtem(a){if(a=document.getElementById(menuItems[a]))a.className="menuItemClicked"}
function closeAppMenu(){var a=document.getElementById("appMenu");a&&(a.style.display="none")}function showHideAbout(a){var b=document.getElementById("aboutDiv");b&&(b.style.display=a?"inline":"none")}
var dateFormat=function(){var a=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,b=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,c=/[^-+\dA-Z]/g,d=function(e,f){e=String(e);for(f=f||2;e.length<f;)e="0"+e;return e};return function(e,f,l){var m=dateFormat;1!=arguments.length||"[object String]"!=Object.prototype.toString.call(e)||/\d/.test(e)||(f=e,e=void 0);e=e?new Date(e):new Date;if(isNaN(e))throw SyntaxError("invalid date");
f=String(m.masks[f]||f||m.masks["default"]);"UTC:"==f.slice(0,4)&&(f=f.slice(4),l=!0);var h=l?"getUTC":"get",g=e[h+"Date"](),k=e[h+"Day"](),n=e[h+"Month"](),p=e[h+"FullYear"](),q=e[h+"Hours"](),u=e[h+"Minutes"](),v=e[h+"Seconds"]();h=e[h+"Milliseconds"]();var t=l?0:e.getTimezoneOffset(),w={d:g,dd:d(g),ddd:m.i18n.dayNames[k],dddd:m.i18n.dayNames[k+7],m:n+1,mm:d(n+1),mmm:m.i18n.monthNames[n],mmmm:m.i18n.monthNames[n+12],yy:String(p).slice(2),yyyy:p,h:q%12||12,hh:d(q%12||12),H:q,HH:d(q),M:u,MM:d(u),
s:v,ss:d(v),l:d(h,3),L:d(99<h?Math.round(h/10):h),t:12>q?"a":"p",tt:12>q?"am":"pm",T:12>q?"A":"P",TT:12>q?"AM":"PM",Z:l?"UTC":(String(e).match(b)||[""]).pop().replace(c,""),o:(0<t?"-":"+")+d(100*Math.floor(Math.abs(t)/60)+Math.abs(t)%60,4),S:["th","st","nd","rd"][3<g%10?0:(10!=g%100-g%10)*g%10]};return f.replace(a,function(r){return r in w?w[r]:r.slice(1,r.length-1)})}}();
dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};dateFormat.i18n={dayNames:"Sun Mon Tue Wed Thu Fri Sat Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),monthNames:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec January February March April May June July August September October November December".split(" ")};
Date.prototype.format=function(a,b){return dateFormat(this,a,b)};
var OnvifDisco={discoComplete:!1,cameras:[],selAuthCam:void 0,currentConfig:void 0,baseUrl:"http://__IPA__:8128",onvifDiscoComplete:void 0,dummy:function(){console.info("OnvifDisco:dummy invoked")},checkDisco:function(){OnvifDisco.httpGetAsync(OnvifDisco.baseUrl+"/cdisco",OnvifDisco.handleDisco)},handleDisco:function(a){202==JSON.parse(a).StatusCode?(OnvifDisco.discoComplete=!0,OnvifDisco.getDiscoCameras()):(console.log("OnvifDisco:",a),window.setTimeout(OnvifDisco.checkDisco,1E3))},doDisco:function(a){OnvifDisco.onvifDiscoComplete=
a;OnvifDisco.httpGetAsync(OnvifDisco.baseUrl+"/disco",OnvifDisco.handleDisco)},doRefresh:function(){OnvifDisco.doDisco(OnvifDisco.onvifDiscoComplete)},getDiscoCameras:function(){OnvifDisco.httpGetAsync(OnvifDisco.baseUrl+"/xgcams",OnvifDisco.handleDiscoCameras)},handleDiscoCameras:function(a){OnvifDisco.cameras=JSON.parse(a);OnvifDisco.onvifDiscoComplete(OnvifDisco.cameras);console.log("OnvifDisco:handleCameras",OnvifDisco.cameras)},httpPostAsync:function(a,b,c){OnvifDisco.httpMethodAsync("POST",
a,b,c)},httpGetAsync:function(a,b,c){OnvifDisco.httpMethodAsync("GET",a,b,c)},httpMethodAsync:function(a,b,c,d){var e=new XMLHttpRequest;e.onreadystatechange=function(){403==e.status?(console.info("~~>Session timeout or logout"),logout("Session ended")):4==e.readyState&&200==e.status&&c(e.responseText,d)};e.onerror=function(f){console.error(b+"failed->"+f);c(""+e.responseText,d)};e.open(a,b,!0);"POST"==a?(e.setRequestHeader("Content-Type","text/plain"),e.send(d)):e.send(null)}},OnvifDiscoUI={currentConfig:void 0,
cameras:[],camOnlySetup:!0,selectedChannel:void 0,selAuthCam:void 0,configChangeListener:void 0,justSavedFlag:!1,show:function(a,b){OnvifDiscoUI.currentConfig=a;OnvifDiscoUI.cameras=b;0<b.length?OnvifDiscoUI.populateCameraList():OnvifDiscoUI.showNoCamerasFound()},getExistingCam:function(a){var b=OnvifDiscoUI.currentConfig;if(null!=b){b=b.OnvifCams;for(var c=0;c<b.length;c++){var d=b[c];if(""!=d.Host&&a.includes(d.Host))return d.Channel="CAM "+(c+1),d}}},refreshDisco:function(){document.getElementById("cameraList").innerHTML=
'<p><span class="searching4Cams">Searching for ONVIF cameras</span></br/></p>';window.setTimeout(OnvifDisco.doRefresh,500)},showNoCamerasFound:function(){document.getElementById("cameraList").innerHTML='<p><span class="searching4Cams">No cameras found<br/>will try again in a few seconds...</span></p>';window.setTimeout(OnvifDiscoUI.refreshDisco,5E3)},populateCameraList:function(){var a=["ID","Address","Camera","Online","Action"];var b='<table id="cameraChannels" cellpadding="10" cellspacing="0"><tr class="cameraChannelsTh">';
for(var c=0;c<a.length;c++)b+="<th>",b+=a[c],b+="</th>";b+="</tr>";for(a=0;4>a;a++)b+="<tr>",b+="<td>",b+=""+(a+1),b+="</td>",b+=OnvifDiscoUI.getCameraConfig(a),b+="</tr>";b+="</table>";document.getElementById("cameraList").innerHTML=b},getCameraOnlineStatus:function(a){for(var b=0;b<OnvifDiscoUI.cameras.length;b++){var c=OnvifDiscoUI.cameras[b];if(c.xAddr.includes(a))return[!0,decodeURIComponent(c.displayName)]}return[!1,""]},getCameraConfig:function(a){var b=OnvifDiscoUI.currentConfig.OnvifCams;
if(a<b.length){var c=b[a];if(0!=c.OnvifPort)return b=OnvifDiscoUI.getCameraOnlineStatus(c.Host),c="<td>"+c.Host,c=c+"</td><td>"+b[1],c=c+"</td><td>"+(b[0]?"Yes":"No"),c=c+"</td>"+OnvifDiscoUI.getActionsForCamera(a,b)}return"<td></td><td></td><td></td>"+OnvifDiscoUI.getActionsForCamera(a,[!1,""])},getActionsForCamera:function(a,b){var c=b[0],d=OnvifDiscoUI.currentConfig.OnvifCams[a];b="<td>";if(c){c=(d.Enabled?"Disable":"Enable")+" camera";if(0==OnvifDiscoUI.camOnlySetup){var e=(d.RecordEnabled?"Disable":
"Enable")+" recording";d=(d.MotionEnabled?"Disable":"Enable")+" motion";b=b+('<button class="actionButton" onclick="toggleEnableCamera('+a+');">'+c+'</button>&nbsp;<button class="actionButton" onclick="toggleEnableRecording(')+(a+');">'+e+"</button>");b+="&nbsp;";b+='<button class="actionButton" onclick="toggleEnableMotion('+a+');">'+d+"</button>";b+="&nbsp;"}b+='<button class="actionButton" onclick="OnvifDiscoUI.removeCameraFor('+a+');">Remove</button>'}else b+='<button class="actionButton" onclick="OnvifDiscoUI.selectCameraFor('+
a+');">Select camera</button>';return b+="</td>"},removeCameraFor:function(a){console.info("OnvifDiscoUI:removeCameraFor",a);OnvifDiscoUI.selectedChannel=a;var b=OnvifDiscoUI.currentConfig.OnvifCams[a];console.info("OnvifDiscoUI:removeCameraFor",b.Host);var c=Object.keys(b);c=Array.from(c);for(var d=0;d<c.length;d++){var e=c[d],f=typeof b[e];"number"==f?b[e]=0:"string"==f?b[e]="":"boolean"==f&&(b[e]=!1)}b.Uid=a;b.Enabled=!1;b.OnvifPort=0;b.RtspPort=0;OnvifDiscoUI.doSave()},doCancel:function(){OnvifDiscoUI.showCamerasOrLogin(!0)},
showCamerasOrLogin:function(a){document.getElementById("loginTable").style.display=a?"none":"inline";var b=document.getElementById("authStatus");b&&(b.innerHTML="");document.getElementById("cameraList").style.display=a?"inline":"none"},selectCameraFor:function(a){console.info("OnvifDiscoUI:selectCameraFor",a);OnvifDiscoUI.selectedChannel=a;a='<select id="camSelect">';for(var b=0;b<OnvifDiscoUI.cameras.length;b++){var c=OnvifDiscoUI.cameras[b];if(OnvifDiscoUI.getExistingCam(c.xAddr))OnvifDiscoUI.selAuthCam=
c;else{var d=c.displayName;c=new URL(c.xAddr);d+=" "+c.hostname;a+='<option value="'+b+'">'+d+"</option>"}}a+="</select>";document.getElementById("unassignedCams").innerHTML=a;OnvifDiscoUI.showCamerasOrLogin(!1);OnvifDiscoUI.disableConnect(!1);OnvifDiscoUI.enableSave(!1)},handleDoSave:function(a){a=JSON.parse(a);if(200==a.StatusCode){if(document.getElementById("loginTable").style.display="none",OnvifDiscoUI.populateCameraList(),OnvifDiscoUI.configChangeListener&&OnvifDiscoUI.configChangeListener(OnvifDiscoUI.currentConfig),
OnvifDiscoUI.showCamerasOrLogin(!0),a=document.getElementById("rebootButton"))a.disabled=!1}else document.getElementById("authStatus").innerHTML=a.StatusMessage},doSave:function(){console.log("doSave");console.info(OnvifDiscoUI.currentConfig);OnvifDiscoUI.justSavedFlag=!0;OnvifDiscoUI.currentConfig.StorageDir="";var a=JSON.stringify(OnvifDiscoUI.currentConfig);OnvifDisco.httpPostAsync(OnvifDisco.baseUrl+"/xsave",OnvifDiscoUI.handleDoSave,a)},handleDoAuth:function(a){a=JSON.parse(a);console.log(a);
document.getElementById("authStatus").innerHTML=a.StatusMessage;200==a.StatusCode?(OnvifDiscoUI.selAuthCam.authenicated=!0,OnvifDiscoUI.getCamera(OnvifDiscoUI.selAuthCam),OnvifDiscoUI.enableSave(!0),OnvifDiscoUI.disableConnect(!0)):(OnvifDiscoUI.enableSave(!1),OnvifDiscoUI.disableConnect(!1))},doAuth:function(){var a=camu.value,b=camp.value;console.info("doAuth",a,b);OnvifDiscoUI.disableConnect(!0);document.getElementById("authStatus").innerHTML="Authenticating, please wait...";var c=document.getElementById("camSelect").value;
OnvifDiscoUI.selAuthCam=OnvifDiscoUI.cameras[c];OnvifDiscoUI.selAuthCam.user=a;OnvifDiscoUI.selAuthCam.password=b;a=a+"\n"+b+"\n"+OnvifDiscoUI.selAuthCam.xAddr;console.log(a);OnvifDisco.httpPostAsync(OnvifDisco.baseUrl+"/xauth",OnvifDiscoUI.handleDoAuth,a)},handleGetCamera:function(a){a=JSON.parse(a);console.log("OnvifDiscoUI:handleGetCamera",a);console.log(a);0<=a.id&&(OnvifDiscoUI.selAuthCam=a)},getCamera:function(a){OnvifDisco.httpGetAsync(OnvifDisco.baseUrl+"/xgcam?cid="+a.id,OnvifDiscoUI.handleGetCamera)},
disableConnect:function(a){var b=document.getElementById("discoButton");b&&(b.className=a?"appButtonDisabled":"appButton",b.disabled=a)},enableSave:function(a){var b=document.getElementById("saveButton");b.className=a?"appButton":"appButtonDisabled";b.disabled=!a},saveSelectedCamera:function(){var a=OnvifDiscoUI.currentConfig.OnvifCams[OnvifDiscoUI.selectedChannel];a.User=OnvifDiscoUI.selAuthCam.user;a.Password=OnvifDiscoUI.selAuthCam.password;a.Enabled=!0;var b=new URL(OnvifDiscoUI.selAuthCam.xAddr);
a.Host=b.hostname;a.OnvifPort=""==b.port?80:b.port;b=OnvifDiscoUI.selAuthCam.profiles[0].url.replace("rtsp://","http://");b=new URL(b);a.RtspPort=""==b.port?554:b.port;a.RtspPath=b.pathname;"/"==a.RtspPath[0]&&(a.RtspPath=a.RtspPath.substring(1));OnvifDiscoUI.doSave()}},wsUri="ws://__IPA__:8130/";function eventsClosed(){toggleEventPlayerVisibility(!1)}var thumbColWidth=236;
function resizeEvents(){var a=document.documentElement.clientWidth-thumbColWidth,b=a/1.67;document.getElementById("eventImage").style.width=""+a+"px";document.getElementById("eventVideo");eventVideo.style.width=""+a+"px";eventVideo.style.height=""+b+"px";var c=document.getElementById("player");c.style.width=""+a+"px";c.style.height=""+b+"px"}
function handleGetEventUri(a,b){console.info(a,b);if(a.startsWith("http")){var c=eventResults[0].Token;if(c==b){var d=document.getElementById("eventImage");d.src=a;d.onload||(d.onload=function(){d.style.display="inline";showEventsPlayBtn(!0)},d.onerror=function(){d.style.display="none"});for(b=1;b<eventResults.length;b++){var e=a.replace(c,eventResults[b].Token);appendThumb(e)}}}}function getEventLink(a,b,c){b=baseEp+"/grecurl?fn="+a;console.log(b);httpGetAsync(b,handleGetEventUri,a)}
var thumbRow=0;function appendThumb(a){var b=thumbColWidth,c=thumbRow,d=new Image;d.id="t_"+thumbRow;d.style.position="relative";d.style.width=""+b+"px";d.style.borderRadius="5px";d.onload=function(){document.getElementById("thumbsDiv").appendChild(d)};d.onerror=function(){console.debug("Failed  to load event image",a)};d.onclick=function(){swapEvent(c)};thumbRow++;window.setTimeout(function(){d.src=a},100)}
function appendThumbOld(a){var b=document.getElementById("thumbsDiv");b.innerHTML+='<img id="t_'+thumbRow+'" src ="'+a+'"  style="position: relative; width: '+thumbColWidth+'px" onclick="swapEvent('+thumbRow+')">';thumbRow++}var selectedThumbSrc=void 0;
function swapEvent(a){toggleEventPlayerVisibility(!1);window.setTimeout(function(){var b=document.getElementById("t_"+a);selectedThumbSrc=b.src;console.log(selectedThumbSrc);var c=document.getElementById("eventImage");b.src=c.src;c.src=selectedThumbSrc},500)}function clearThumbs(){var a=document.getElementById("thumbsDiv");a.innerHTML="";thumbRow=0;for(console.info("events:clearEvents");a.firstChild;)a.removeChild(a.lastChild);console.info("events:clearEvents->done");showEventsPlayBtn(!1)}
function showEventsPlayBtn(a,b){var c=document.getElementById("playEventBtn"),d=document.getElementById("playEventLabel");c.style.display=a?"inline":"none";b?(d.style.display="inline",d.innerHTML=b):a||(d.style.display="none")}var eventResults=[];
function handleGetEvents(a){eventResults=JSON.parse(a);a=document.getElementById("loadingEvents");0==eventResults.length?a.innerHTML="No recent events found":a.style.display="none";clearThumbs();0<eventResults.length&&getEventLink(eventResults[0].Token)}function getLatestEvents(){if(initWebSocket()){var a=(new Date).toISOString().substring(0,10);a=baseEp+"/glevts?sd="+a+"&vmd=1&max=5";console.log(a);httpGetAsync(a,handleGetEvents)}}
function doSearch(){var a=document.getElementById("searchDay").value;console.info("doSearch",a);updateSearchStatus("Searching...");getVideos(a)}var lastVideoEventBlob=void 0;function stopEventPlayback(){toggleEventPlayerVisibility(!1);showEventsPlayBtn(!0)}function handleGetVideoEventBlob(a){var b=document.getElementById("eventVideo");lastVideoEventBlob=URL.createObjectURL(a);b.src=lastVideoEventBlob;b.style.display="inline";document.getElementById("closeEventVideo").style.display="inline"}
function toggleEventPlayerVisibility(a,b){var c=document.getElementById("eventVideo"),d=document.getElementById("closeEventVideo");b?(b.endsWith(".mp4")&&(b+="?wc=1"),console.debug("toggleEventPlayerVisibility",b),lastVideoEventBlob&&URL.revokeObjectURL(lastVideoEventBlob),httpGetBlobAsync(b,handleGetVideoEventBlob)):(c.pause(),c.src=null,showEventsPlayBtn(!1));c.style.display="none";d.style.display="none";document.getElementById("eventImageDiv").style.display=a?"none":"inline"}
function handleGetV4E(a){console.log("handleGetV4E",a);"404"==a?showEventsPlayBtn(!1,"No matching video clip found"):(toggleEventPlayerVisibility(!0,a+"?wc=0"),showEventsPlayBtn(!1,""))}function playVideoEvent(){var a=eventResults[0].Token;selectedThumbSrc&&(console.log("SELECTED THUMB",selectedThumbSrc),a=selectedThumbSrc.split("/"),a=a[a.length-1],console.log("SELECTED TOKEN",a));a=baseEp+"/gv4e?fn="+a;showEventsPlayBtn(!1,"Preparing video snippet...");httpGetAsync(a,handleGetV4E)}
var websocket=void 0,websocketEventDelegate;
function initWebSocket(){if(websocket)return!1;websocket=new WebSocket(wsUri);websocket.onopen=function(a){console.info("Websocket CONNECTED")};websocket.onclose=function(a){console.info("Websocket DISCONNECTED");websocket=void 0};websocket.onmessage=function(a){console.info("Websocket:in ->",a.data);a=JSON.parse(a.data);console.log(a);if(a.Token&&a.Time){var b=[];b.push(a);for(var c=0;4>c;c++)c<eventResults.length&&b.push(eventResults[c]);eventResults=[];for(c=0;c<b.length;c++)eventResults.push(b[c]);
clearThumbs();document.getElementById("loadingEvents").style.display="none";getEventLink(a.Token)}else console.log("WebSocket:onMessage (NOT JRecordingRep)",a),websocketEventDelegate&&websocketEventDelegate(a)};websocket.onerror=function(a){console.info("Websocket ERROR",a.data)};return!0}var showWaitingState=new Map,videoPlayingDelegate=void 0;
function showVideoWaiting(a,b){(showWaitingState[b]=a)?window.setTimeout(function(){showWaitingState[b]?doShowWaitingState(!0,b):console.log("Ignored short waiting call")},2500):doShowWaitingState(a,b)}function doShowWaitingState(a,b){console.log("doShowWaitingState",a,b);var c=document.getElementById(b);c&&(c.style.display=a?"inline":"none",videoPlayingDelegate&&videoPlayingDelegate(b,a))}var hlsObjs=[],hlsCreates=[];
function hlsDestroyAll(){for(var a=0;a<hlsObjs.length;a++)console.info("Destroying HLS "+a),hlsObjs[a].destroy();for(a=0;a<hlsCreates.length;a++)console.info("Destroying HLS DOM Listener "+a),window.removeEventListener("DOMContentLoaded",hlsCreates[a],!0);hlsObjs=[];hlsCreates=[]}
function createPlayer(a,b,c,d){var e="http://"+a+":8888/"+b;console.info(e);var f=c+"Waiting",l=function(){showVideoWaiting(!0);var m=document.getElementById(c);if(Hls.isSupported()){var h=new Hls({maxLiveSyncPlaybackRate:1.5});hlsObjs.push(h);h.on(Hls.Events.ERROR,function(g,k){k.fatal?(console.info("FATAL ERROR attempt reconnect",g),h.destroy(),window.removeEventListener("DOMContentLoaded",l),setTimeout(l,2E3)):console.info(g,k)});h.on(Hls.Events.MEDIA_ERROR,function(g,k){console.log(g,k)});h.on(Hls.Events.MEDIA_ATTACHED,
function(){console.log("MEDIA_ATTACHED")});h.on(Hls.Events.MEDIA_DETACHED,function(){console.log(">>Hls.Events.MEDIA_DETACHED");showVideoWaiting(!0,f)});h.loadSource(e+"/index.m3u8");h.attachMedia(m);m.play()}else m.canPlayType("application/vnd.apple.mpegurl")&&fetch(e+"/stream.m3u8").then(function(){m.src=e+"/index.m3u8";m.play()})};d?l():(hlsCreates.push(l),window.addEventListener("DOMContentLoaded",l));showVideoWaiting(!0,f);addVideoEventLogger(c,f)}
function addVideoEventLogger(a,b){a=document.getElementById(a);a.addEventListener("abort",log);a.addEventListener("ended",function(c){log(c);showVideoWaiting(!0,b)});a.addEventListener("error",log);a.addEventListener("interruptbegin",log);a.addEventListener("interruptend",log);a.addEventListener("pause",log);a.addEventListener("play",log);a.addEventListener("playing",function(c){log(c);showVideoWaiting(!1,b)});a.addEventListener("suspend",function(c){log(c);showVideoWaiting(!0,b)});a.addEventListener("waiting",
function(c){log(c);showVideoWaiting(!0,b)})}function log(a){console.log(new Date+": "+a.type+"\n")}
var CameraToolbar={ids:"PTZ Vmd Rec Rot help Close".split(" "),enabled:[!1,!0,!0,!0,!0,!0],iconTop:[4,4,4,4,4,4,40],iconScale:[1,.98,1.08,.9,1.15,.9],icons:"ptz_light vmd_light start_recording flip_light help_light xmenu_close".split(" "),titles:"PTZ;Enable disable motion detection;Enable disable recording;Flip 180 degrees;Help;Close toolbar".split(";"),mediaPath:"web/media/",create:function(a,b){var c="",d=10;b||(b=32);for(var e=0;e<this.icons.length;e++){var f="tb"+this.ids[e]+"Icon";c+='<div style="position: absolute; top: '+
(this.iconTop[e]+"px;left: "+d+"px; opacity: "+(this.enabled[e]?1:.5)+";transform: scale("+this.iconScale[e]+');" title="')+this.titles[e]+'" onclick="lsToolbarAction('+e+');">';c+='<img id="'+f+'" src="'+this.mediaPath+this.icons[e]+'.png" width="24">';c+="</div>";d+=b}console.debug(c);document.getElementById(a).innerHTML=c}},sid="",tabDivs=["vidDiv","mapDiv","deviceDiv","storageDiv","eventsDiv"],tabHeaders=["cameraTab","mapTab","deviceTab","storageTab","eventsTab"],currentTab=0,appSettings=void 0,
lsSelectedCam=-1;function showHideEl(a,b){console.log("showHide",a,b);var c=document.getElementById(a);c?c.style.display=b?"block":"none":console.debug("showHide",a,"not found")}function proResize(){var a=["xmapDiv"],b;for(b in a){var c=document.getElementById(a[b]);c&&(c.style.width=""+getWidth()+"px",c.style.height=""+(getHeight()-80)+"px")}}
function getWidth(){return Math.max(document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth,document.documentElement.clientWidth)}function getHeight(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight)}
function tabClicked(a){currentTab=a;for(var b=0;b<tabDivs.length;b++){var c=document.getElementById(tabDivs[b]);c&&(c.style.display=b==a?"block":"none");if(c=document.getElementById(tabHeaders[b]))c.className=b==a?"toolbarTab":"toolbarTabDisable"}showHideEl("flipCtrl",!1);eventsClosed&&eventsClosed();closeHelp();switch(a){case 0:0==appSettings.DeviceMode&&showHideEl("flipCtrl",!0);break;case 1:getDeviceLocation(sid);break;case 2:getDeviceInfo(sid);break;case 3:initStorage();break;case 4:getLatestEvents()}if(b=
document.getElementById("waitingDiv"))b.style.visibility=0==a?"visible":"hidden"}function resizeDeviceInfo(){var a=document.getElementById("deviceDetails");a&&(a.style.height=document.body.clientHeight-100+"px",console.debug("deviceDiv.style.height",a.style.height))}function getDeviceInfo(a){httpGetAsync("http://__IPA__:8127/devinfo",handleGetDeviceInf)}
function handleGetDeviceInf(a){var b=a.split("\n");a='<div id="deviceDetails"><table width="100%">';appSettings&&(a=a+'<tr><td width="150">DeviceMode</td><td align="left">'+(0==appSettings.DeviceMode?"Pi Camera":"vNVR")+"</td>",a+="</tr>");for(var c=0;c<b.length;c++)if(0!=b[c].length){var d=b[c].split("=");a+="<tr>";a+='<td width="150">';a+=d[0];a+="</td>";a+='<td align="left">';a+=d[1];a+="</td>";a+="<td></td>";a+="</tr>"}if(appSettings)for(b=["User","Password","Online","CamPath","HasPtz"],c=appSettings.OnvifCams,
d=0;d<c.length;d++){a+='<tr><td colspan="3"><hr/></td></tr>';var e=c[d],f=Object.keys(e);console.info(f);for(var l=0;l<f.length;l++){var m=f[l],h=e[m];if(h){for(var g=!1,k=0;k<b.length;k++)if(b[k]==m){g=!0;break}g||(a+="<tr>",a+='<td width="150">',a+=m,a+="</td>",a+='<td align="left">',a+=h,a+="</td>",a+="<td></td>",a+="</tr>")}}}a+='<tr><td colspan="3"><hr/></td></tr><tr><td colspan="3"><button id="rebootButton" onclick="promptReboot();">Reboot device</button></td></tr></table></div>';if(b=document.getElementById("deviceDiv"))b.innerHTML=
a;window.setTimeout(function(){resizeDeviceInfo()},500)}var xmap=void 0,gpsMarker=void 0,gps=void 0;function getDeviceLocation(a){httpGetAsync("http://__IPA__:8127/gps",handleGps)}gps=gpsMarker=void 0;var hasLocation=!1;
function handleGps(a){console.info(a);try{gps=JSON.parse(a);if(gps.lat){hasLocation=!0;var b=document.getElementById("gpsIcon");b&&(b.style.opacity="1",b.src="/web/gps_on_icon.png");showMap()}else if(!hasLocation){var c=document.getElementById("xmapDiv");c.style.display="block";c.innerHTML='<span style="color: white; padding: 10px;">LOCATION NOT FIXED</span>'}console.info(gps)}catch(d){console.error(d)}}
function showMap(){gps.lat&&(document.getElementById("xmapDiv").style.display="block",void 0==xmap&&(xmap=createMap("xmapDiv",gps.lat,gps.lon,15)),gpsMarker&&gpsMarker.remove(),window.setTimeout(function(){var a=[gps.lat,gps.lon];gpsMarker=L.marker(a).addTo(xmap);xmap.flyTo(a)},3E3))}var accessToken="pk.eyJ1IjoicGhpbGJpc2hvcCIsImEiOiJjanZxMTBteHQxa2FhM3lsZW9kbm0ydHNmIn0.tFWCR6RTNXzxy-OT-8DOKQ";
function createMap(a,b,c,d){console.info("createMap",b,c);a=L.map(a,{zoomControl:!1,attributionControl:!1});L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery \u00a9 <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:18,id:"mapbox/streets-v11",tileSize:512,boxZoom:!1,zoomOffset:-1,
accessToken:""+accessToken}).addTo(a);a.setView([b,c],d);d=L.control.zoom({zoomInText:"+",zoomOutText:"-"});d.addTo(a);return a}function doFlip(a){document.getElementById("video").style.transform=a.checked?"scale(-1,-1)":"scale(1,1)"}function lsDoFlip(a){a=document.getElementById(a);a.style.transform.includes("rotate")?a.style.transform="":a.style.transform="rotate(180deg)"}function handleRebootDevice(a){console.log("handleRebootDevice",a)}
function promptReboot(){confirm("Reboot device?")&&confirm("Are you absolutely sure you want to reboot?")&&httpGetAsync("/reboot",handleRebootDevice)}
function docInit(a,b){function c(){document[d]?(console.log("Doc hidden"),a()):(console.log("Doc visible"),b())}if("undefined"!==typeof document.hidden){var d="hidden";var e="visibilitychange"}else"undefined"!==typeof document.msHidden?(d="msHidden",e="msvisibilitychange"):"undefined"!==typeof document.webkitHidden&&(d="webkitHidden",e="webkitvisibilitychange");"undefined"===typeof document.addEventListener||void 0===d?console.log("This app requires a browser, such as Google Chrome or Firefox, that supports the Page Visibility API."):
document.addEventListener(e,c,!1)}var lsStreamPlaying=[!1,!1,!1,!1];function lsHideIndicators(){for(var a=0;a<vdivs.length;a++){var b=vdivs[a],c=b+"VmdIcon";lsGetElement(b+"RecIcon").style.display="none";lsGetElement(c).style.display="none"}}
function lsPlayStateChanged(a,b){if(waitingDivs)for(var c=0;c<waitingDivs.length;c++){if(waitingDivs[c]==a){lsStreamPlaying[c]=!b;var d=vdivs[c],e=d+"VmdIcon",f=appSettings.OnvifCams[c];document.getElementById(d+"RecIcon").style.display=!b&&f.RecordEnabled?"inline":"none";document.getElementById(e).style.display=!b&&f.MotionEnabled?"inline":"none"}vdivs[c]==mainCamDiv&&showCameraToolbar(lsStreamPlaying[c])}}
function lsUpdateIndicators(){for(var a=0;a<vdivs.length;a++){var b=vdivs[a],c=b+"VmdIcon",d=lsStreamPlaying[a],e=appSettings.OnvifCams[a];document.getElementById(b+"RecIcon").style.display=d&&e.RecordEnabled?"inline":"none";document.getElementById(c).style.display=d&&e.MotionEnabled?"inline":"none"}}function showCameraToolbar(a){var b=lsGetElement("camToolbar");b&&(b.style.display=a?"inline":"none");closeHelp()}
function lsCameraSelected(a){lsSelectedCam=a;a=appSettings.OnvifCams[a];var b=lsGetElement("tbRecIcon");if(b){var c=lsGetElement("tbRecLabel"),d=lsGetElement("tbVmdIcon"),e="start_recording.png",f="OFF";a.RecordEnabled&&(e="stop_recording.png",f="ON");c&&(c.innerHTML=f);b.src="web/media/"+e;b="vmd_light.png";a.MotionEnabled&&(b="vmd_on_dark.png");d.src="web/media/"+b}else console.debug("CameraToolbar not ready")}function lsGetElement(a){return document.getElementById(a)}
function lsToolbarAction(a){var b=appSettings.OnvifCams[lsSelectedCam];console.log("lsToolbarAction",b.Host,a);switch(a){case 1:b.MotionEnabled=!b.MotionEnabled;lsSave();break;case 2:b.RecordEnabled=!b.RecordEnabled;lsSave();break;case 3:lsDoFlip(vdivs[lsSelectedCam]);break;case 4:showHelp();break;case 5:showCameraToolbar(!1)}}var lsJustSavedFlag=!1;function handleLsSave(a){console.info("handleLsSave",a);window.setTimeout(function(){lsCameraSelected(lsSelectedCam);lsUpdateIndicators()},100)}
function lsSave(){console.log("lsSave");console.info(appSettings);lsJustSavedFlag=!0;var a=JSON.stringify(appSettings);httpPostAsync("/xsave",handleLsSave,a)}function httpPostAsync(a,b,c){httpMethodAsync("POST",a,b,c)}function httpGetAsync(a,b,c){httpMethodAsync("GET",a,b,c)}
function httpMethodAsync(a,b,c,d){var e=new XMLHttpRequest;e.onreadystatechange=function(){403==e.status?(console.info("~~>Session timeout or logout"),logout("Session ended")):4==e.readyState&&200==e.status&&c(e.responseText,d)};e.onerror=function(f){console.error(b+"failed->"+f);c(""+e.responseText,d)};e.open(a,b,!0);"POST"==a?(e.setRequestHeader("Content-Type","text/plain"),e.send(d)):e.send(null)}
function httpGetBlobAsync(a,b,c){var d=new XMLHttpRequest;d.onload=function(){200===this.status&&b(this.response,c)};d.onerror=function(e){b(""+d.responseText,c,e)};d.open("GET",a,!0);d.responseType="blob";d.send()}var baseEp="http://__IPA__:8127",range=void 0;function showHide(a,b){var c=document.getElementById(a);c?c.style.display=b?"block":"none":console.debug("showHide",a,"not found")}
function enableDisable(a,b){console.log("enableDisable",a,b);var c=document.getElementById(a);c?c.disabled=b?!1:!0:console.debug("enableDisable",a,"not found")}function resizeStorage(){var a=document.getElementById("resultsTable"),b=document.body.clientHeight-250+"px";a&&(a.style.height=b);if(a=document.getElementById("playerDiv"))a.style.width=""+document.body.clientWidth+"px",a.style.height=b}
function closeVideo(){showHide("closeVideoBtn",!1);var a=document.getElementById("player");a.pause();a.currentTime=0;showHide("playerDiv",!1);showHide("searchResults",!0);showHide("searchWaitingDiv",!1);showHide("searchTable",!0);enableDisable("searchDay",!0);enableDisable("camSelect",!0);updateSearchStatus("Found "+searchResults.length)}var lastVideoBlob=void 0;
function handleGetVideoBlob(a,b){var c=document.getElementById("player");lastVideoBlob=URL.createObjectURL(a);c.src=lastVideoBlob;showHide("playerDiv",!0);updateSearchStatus(videoTitle);showHide("closeVideoBtn",!0);showHide("searchWaitingDiv",!1);showHide("searchTable",!1);getEventsForVideo(b)}
function handleGetVideoUri(a,b){console.info(a,b);var c=a;if(c.startsWith("http")){b.replace(".mp4","");if(a=document.getElementById(b))a.style="color: blue; font-style: italic;";c.endsWith(".mp4")&&(c+="?wc=1");console.debug("handleGetVideoUri",c);httpGetBlobAsync(c,handleGetVideoBlob,b)}else updateSearchStatus(a)}var videoTitle="";
function getVideoLink(a,b,c){lastVideoBlob&&(URL.revokeObjectURL(lastVideoBlob),lastVideoBlob=void 0);videoTitle=b+" "+c;updateSearchStatus("Waiting for video...");showHide("searchResults",!1);showHide("searchWaitingDiv",!0);enableDisable("searchDay",!1);enableDisable("camSelect",!1);b=baseEp+"/grecurl?fn="+a;console.log(b);httpGetAsync(b,handleGetVideoUri,a)}var searchResults=void 0;function updateSearchStatus(a){document.getElementById("searchStatus").innerHTML=a}
function handleGetVideos(a){searchResults=JSON.parse(a);updateSearchStatus("Found "+searchResults.length);showHide("searchResults",!0);showHide("searchWaitingDiv",!1);populateResults(searchResults)}function getVideos(a){a=baseEp+"/gvids?sd="+a;console.log(a);httpGetAsync(a,handleGetVideos)}function doSearch(){var a=document.getElementById("searchDay").value;console.info("doSearch",a);updateSearchStatus("Searching...");window.setTimeout(function(){getVideos(a)},250)}
var zeroPad=function(a,b){return String(a).padStart(b,"0")},HourSlot=function(a){this.hr=a;this.items=[];this.expanded=!1},hrs2Vid=[];function expandCollapse(a){for(var b=0;b<hrs2Vid.length;b++){var c=hrs2Vid[b];if(c.hr==a){b=document.getElementById(""+a+"_row");a=document.getElementById(""+a+"_btn");c.expanded=!c.expanded;b.style.display=c.expanded?"inline":"none";a.innerHTML=c.expanded?"-":"+";break}}}
function populateResults(a){var b=[];hrs2Vid=[];for(var c=0;24>c;c++)hrs2Vid.push(new HourSlot(c));for(c=0;c<a.length;c++){var d=a[c];b.includes(d.CamId)||b.push(d.CamId);var e=d.Time.split(":");e=parseInt(e[0]);for(var f=0;f<hrs2Vid.length;f++){var l=hrs2Vid[f];if(l.hr==e){l.items.push(d);break}}}a='<div id="resultsTable"><table width="100%">';for(c=0;c<hrs2Vid.length;c++)if(e=c,d=applyFilter(hrs2Vid[c]),l=d.items.length,0!=l){for(var m=f=0;m<d.items.length;m++)f+=d.items[m].VmdCount;l=""+l+"&nbsp;";
0<f&&(m="<table><tr>",m+="<td>",m+='<span style="font-size: 11px; color: red;">'+f+"</span>",m+="</td>",m+="<td>",m+=l,m+="</td>",l=m+="</tr></table>");a+="<tr>";a+='<td width="20">';a+='<button id="'+e+"_btn\" onclick='expandCollapse("+e+")';>+</button>";a+="</td>";a+="<td>";a+=zeroPad(e,2)+":00 - "+zeroPad(e,2)+":59";a+="</td>";a+='<td align="right">'+l+"</td>";a+="</tr>";a+="<tr>";a+="<td></td>";a+='<td colpan="2">';a+='<div id="'+e+'_row" style="display: none;">';a+='<table cellspacing="10">';
for(e=0;e<d.items.length;e++)f=d.items[e],a+='<tr id="'+f.Token+'" >',a+="<td>",a+=f.Time,a+="</td>",a+="<td>",f.CamId&&(a+=f.CamId),a+="</td>",a+='<td width="20">',f.VmdCount&&0<f.VmdCount&&(a+='<img src ="web/media/vmd_alert_light.png" width="20">'),a+="</td>",a+='<td align="right" valign="bottom">',a+='<img src="web/media/play-icon_black.png" width="15" onclick="getVideoLink(\''+f.Token+"','"+f.CamId+"','"+f.Time+"');\">",a+="</td>",a+="</tr>";a+="</table></div>";a+="</td>";a+="</tr>"}a+="</table></div>";
c=document.getElementById("searchResults");c.innerHTML=a;c.style.display="inline";a='<label for="camSelect">Filter</label><select name="camSelect" id="camSelect" onchange="onFilterChanged();"  class="searchStyle"><option value="-1">All cameras</option>';for(c=0;c<b.length;c++)d="",cameraFilter&&cameraFilter==b[c]&&(d=" selected"),a+='<option value="'+c+'"'+d+">"+b[c]+"</option>";a+="</select>";document.getElementById("camFilter").innerHTML=a;window.setTimeout(doResize,500)}var cameraFilter=void 0;
function applyFilter(a){if(cameraFilter){for(var b=new HourSlot(a.hr),c=0;c<a.items.length;c++){var d=a.items[c];d.CamId==cameraFilter&&b.items.push(d)}return b}return a}function onFilterChanged(){var a=document.getElementById("camSelect");if(a){var b=a.selectedIndex,c=a.options[b].text;console.info("CameraSelect changed",b,a.value,c);cameraFilter=0==b?void 0:c}populateResults(searchResults)}
function handleGetRange(a){console.log(a);range=JSON.parse(a);console.info(range);a=document.getElementById("searchTable");var b=["rrFirst","rrLast","rrNum"],c=new Date(range.Latest),d=""+range.Count;c=[(new Date(range.Earliest)).format(),c.format(),d];for(d=0;d<b.length;d++)document.getElementById(b[d]).innerHTML=c[d];a.style.display="inline"}function getRecordingRange(){var a=baseEp+"/grrange";console.log(a);httpGetAsync(a,handleGetRange)}
var videoEventThumbRow=0,vthumbColWidth=220,vthumbLabelHeight=16;function setVideoVmdLabelEnabled(a){var b=document.getElementById("videoVmdLabel");b&&(b.style.backgroundColor=a?"var(--tswlightred)":"lightgray")}
function handleGetEvents4Video(a){a=JSON.parse(a);console.log("Events for video",a);document.getElementById("playerEventsDiv").innerHTML="";videoEventThumbRow=0;setVideoVmdLabelEnabled(0<a.length);for(var b=0;b<a.length;b++){var c=a[b];httpGetAsync(baseEp+"/grecurl?fn="+c.Token,handleGetE4Vlink,c)}}function getEventsForVideo(a){a=baseEp+"/ge4v?fn="+a;console.log(a);setVideoVmdLabelEnabled(!1);httpGetAsync(a,handleGetEvents4Video)}
function handleGetE4Vlink(a,b){var c=document.getElementById("playerEventsDiv"),d=c.innerHTML,e=vthumbColWidth,f=0;b.HourSlot&&(f=parseInt(b.HourSlot));d+='<img id="vt_'+videoEventThumbRow+'" src ="'+a+'"  style="position: relative; width: '+e+'px;border-radius: 5px;" onclick="gotoEvent('+f+');">';console.info("handleGetE4Vlink for",b);d+='<span style="position: relative;left: 5px;color: black;">'+b.Time+"<span>";c.innerHTML=d;videoEventThumbRow++}
function gotoEvent(a){console.log("gotoEvent",a);5<a&&(document.getElementById("player").currentTime=a-2)}var storageInitialized;function initStorage(){storageInitialized||(storageInitialized=!0,window.setTimeout(function(){document.getElementById("searchDay").value=(new Date).toISOString().substring(0,10);doSearch();getRecordingRange()},500))};
